---
title: 鸿蒙-状态管理V2其他方法
tags: [HarmonyOS]
date: 2025-02-17 21:40:11
keywords: HarmonyOS,鸿蒙应用开发,鸿蒙手机应用开发,状态管理,@ObservedV2,@Trace,@ComponentV2,@Observe,@ObjectLink,ForEach循环渲染
---

## 前言
在前面我们介绍了鸿蒙状态管理V1和V2中有哪些装饰器以及如何使用，还有踩过的坑。本篇文章着重介绍V2版本其他的状态管理方法。

## @ObservedV2的类实例不支持JSON.stringify序列化

这个主要是针对使用new操作符创建且被`@ObservedV2`装饰的对象。即便是使用`UIUtils.getTarget`方法来获取原始对象，也不会对V2装饰器生成的前缀进行处理:[](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-new-makeobserved-V5)
> 状态管理V2装饰器会为装饰的变量生成getter和setter方法，同时为原有变量名添加"__ob_"的前缀。出于性能考虑，getTarget接口不会对V2装饰器生成的前缀进行处理，因此向getTarget接口传入@ObservedV2装饰的类对象实例时，返回的对象依旧为对象本身，且被@Trace装饰的属性名仍有"__ob_"前缀。

来看个例子：
``` TypeScript
@ObservedV2
class Person {
  @Trace name: string = ''
  @Trace age: number = 0
  @Trace address: Address = new Address()
}

@ObservedV2
class Address {
  @Trace zipCode: string = '000000'
  @Trace city: string = '北京'
}
```
两个数据类，被`@ObservedV2`修饰。再来创建两个实例对象，一个使用`new`操作符创建，另外一个从json字符串中反序列化。
``` TypeScript
  @Local person: Person = new Person()
  @Local jsonPerson: Person | undefined = undefined
  aboutToAppear(): void {
    this.person.name = 'xuan'
    this.person.age = 18

    let personJSON: string = `
    {
    "name": "huangyuan",
    "age": 19,
    "address": {
        "zipCode": "111111",
        "city": "shangdong"
      }
    }
    `
    let tmp = JSON.parse(personJSON) as Person
    this.jsonPerson = UIUtils.makeObserved(tmp)
  }
```
然后我们输出一下使用`JSON.stringify`序列化之后的字符串
``` TypeScript
Button('makeObserved 转为json').onClick((_)=>{
  hilog.error(0x01,'StateManagerV2Page',`toJSON: ${JSON.stringify(this.jsonPerson)}`)
})
Button('new对象 转为json').onClick((_)=>{
  hilog.error(0x01,'StateManagerV2Page',`toJSON: ${JSON.stringify(this.person)}`)
})
Button('new对象 getTarget 转为json').onClick((_)=>{
  hilog.error(0x01,'StateManagerV2Page',`toJSON: ${JSON.stringify(UIUtils.getTarget(this.person))}`)
})
```
当我们一次点击这三个按钮后，控制台输出
> toJSON: {"name":"huangyuan","age":19,"address":{"zipCode":"111111","city":"shangdong"}}
> toJSON: {"__ob_name":"xuan","__ob_age":18,"__ob_address":{"__ob_zipCode":"000000","__ob_city":"北京"}}
> toJSON: {"__ob_name":"xuan","__ob_age":18,"__ob_address":{"__ob_zipCode":"000000","__ob_city":"北京"}}

可以看到，使用`new`操作符创建的ObservedV2对象属性都添加了`__ob_`前缀。