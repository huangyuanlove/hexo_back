---
title: kotlinæ³›å‹:é€†å˜ä¸åå˜
tags: [Kotlin,Android]
date: 2024-04-30 10:59:38
mermaid: true
keywords: kotlin æ³›å‹,é€†å˜,Covariant,åå˜,Variance,ä½¿ç”¨å¤„å‹å˜,å£°æ˜å¤„å‹å˜,æ˜ŸæŠ•å½±,Star-Projections
---
æ³›å‹ä¸­æ¶‰åŠåˆ°çš„æ¦‚å¿µä¹Ÿä¸å°‘,å‹å˜(Variance)ã€é€†å˜(Contravariance)ã€åå˜(Covariance)ã€ä¸å˜(Invariant).åœ¨ kotlin ä¸­è¿˜æœ‰ä¸‰ä¸ªå…³é”®å­—`in`ã€`out`ã€`where`ã€`reified`ç­‰,åœ¨javaä¸­åŒæ ·ä¹Ÿæœ‰`? extends`ã€`? super`ã€`?`
è¿™äº›æ¦‚å¿µæ˜¯å•¥æ„æ€å˜ï¼Ÿå¼•ç”¨ç‚¹æ¦‚å¿µè¯´æ˜
> å‹å˜(Variance)ã€åå˜(Covariance)ã€é€†å˜(Contravariance)å’Œä¸å˜(Invariant)æ˜¯ç›¸å…³ä½†ä¸åŒçš„æ¦‚å¿µ.

>å‹å˜æ˜¯æŒ‡æ³›å‹ç±»å‹å‚æ•°åœ¨å­ç±»å‹å…³ç³»ä¸­çš„è¡Œä¸º.å®ƒæè¿°äº†ä¸€ä¸ªæ³›å‹ç±»å‹æ˜¯å¦å…è®¸ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¸æ³›å‹ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¿æŒä¸€è‡´.åœ¨æ³›å‹ä¸­,å¯ä»¥æœ‰ä¸‰ç§å‹å˜ç±»å‹ï¼šåå˜ã€é€†å˜å’Œä¸å˜.

>åå˜æ˜¯æŒ‡å¦‚æœä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¿æŒä¸€è‡´,åˆ™è¯¥æ³›å‹ç±»å‹æ˜¯åå˜çš„.ç®€è€Œè¨€ä¹‹,å¦‚æœå­ç±»å‹çš„æ³›å‹å‚æ•°æ˜¯çˆ¶ç±»å‹æ³›å‹å‚æ•°çš„å­ç±»å‹,å°±å¯ä»¥è¯´è¯¥æ³›å‹ç±»å‹æ˜¯åå˜çš„.

>é€†å˜æ˜¯æŒ‡å¦‚æœä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ç›¸å,åˆ™è¯¥æ³›å‹ç±»å‹æ˜¯é€†å˜çš„.ç®€è€Œè¨€ä¹‹,å¦‚æœå­ç±»å‹çš„æ³›å‹å‚æ•°æ˜¯çˆ¶ç±»å‹æ³›å‹å‚æ•°çš„è¶…ç±»å‹,å°±å¯ä»¥è¯´è¯¥æ³›å‹ç±»å‹æ˜¯é€†å˜çš„.

>ä¸å˜æ˜¯æŒ‡ä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°æ— å…³,å³ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¸æ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»æ— å…³.åœ¨ä¸å˜çš„æƒ…å†µä¸‹,ä¸èƒ½å°†çˆ¶ç±»å‹çš„å¯¹è±¡èµ‹å€¼ç»™å­ç±»å‹çš„å¯¹è±¡,ä¹Ÿä¸èƒ½å°†å­ç±»å‹çš„å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»å‹çš„å¯¹è±¡.

>å› æ­¤,å¯ä»¥è¯´åå˜å’Œé€†å˜æ˜¯å‹å˜çš„ä¸¤ç§å…·ä½“å½¢å¼,è€Œä¸å˜åˆ™æ˜¯å‹å˜çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ.

>æ€»ç»“èµ·æ¥,åå˜ã€é€†å˜å’Œä¸å˜æè¿°äº†æ³›å‹ç±»å‹å‚æ•°ä¸æ³›å‹ç±»å‹ä¹‹é—´å­ç±»å‹å…³ç³»çš„ä¸åŒè¡Œä¸º.åå˜å’Œé€†å˜æ˜¯å¯¹å­ç±»å‹å…³ç³»çš„å…·ä½“çº¦æŸ,è€Œä¸å˜åˆ™æ˜¯æ²¡æœ‰ä»»ä½•å­ç±»å‹å…³ç³»çš„çº¦æŸ.å®ƒä»¬ä¹‹é—´æ˜¯äº’ç›¸æ’æ–¥çš„å…³ç³»,ä¸æ˜¯åŒ…å«å…³ç³».

ä¸€è„¸æ‡µäº†å§ğŸ˜³?é—®é¢˜ä¸å¤§,ç»“åˆä»£ç å…·ä½“çœ‹ä¸€ä¸‹å°±å·®ä¸å¤šäº†

æˆ‘ä»¬è¿˜æ˜¯ç»“åˆ java å’Œ kotlin å¯¹æ¯”æ¥çœ‹ä¸€ä¸‹

### Javaä¸­çš„æ³›å‹
æˆ‘ä»¬å…ˆç”¨Javaä»£ç æ¥çœ‹ä¸€ä¸‹,å‡å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸‰ä¸ªç±»ï¼š
``` java
public class Animal {
}

public class Dog extends Animal {
}

public static class Poodle extends Dog {
}

public class Bird extends Animal {
}
```
ç”±äº java çš„å¤šæ€æ€§,æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™
``` java
Animal animalDog = new Dog();
Animal animalBird = new Bird();
ArrayList<Animal> animalList = new ArrayList<>();
animalList.add(new Bird());
animalList.add(new Dog());
```
è¿™ä¹ˆå†™æ˜¯æ²¡é—®é¢˜çš„,æˆ‘ä»¬å¯ä»¥æŠŠå­ç±»æ·»åŠ åˆ°çˆ¶ç±»åˆ—è¡¨ä¸­,ä½†å½“æˆ‘ä»¬åœ¨`animalList`ä¸­è·å–æ•°æ®æ—¶è¿”å›çš„æ˜¯`Animal`ç±»å‹,å¦‚æœç”¨åˆ°å­ç±»çš„ç‰¹æ€§,è¿˜éœ€è¦ä½¿ç”¨`instanceof`æ¥åˆ¤æ–­ä¸€ä¸‹ç±»å‹.
ä½†å¦‚æœæˆ‘ä»¬è¿™ä¹ˆå†™æ˜¯ä¸è¡Œçš„
``` Java
ArrayList<Animal> animalList = new ArrayList<Dog>();
```
å› ä¸º java çš„æ³›å‹å…·æœ‰ä¸å˜æ€§,åœ¨Java é‡Œé¢è®¤ä¸º`ArrayList<Animal>`å’Œ`ArrayList<Dog>`æ²¡å•¥å…³ç³».
åŒæ ·çš„,å½“æˆ‘ä»¬æƒ³è¦ç”¨æ–¹æ³•é‡è½½æ—¶ä¹Ÿä¼šé‡åˆ°è¿™ç§æƒ…å†µ
``` Java
public void animal(ArrayList<Dog> dogs){
    
}
public void animal(ArrayList<Bird> birds){
    
}
```
å¦‚æœæˆ‘ä»¬è¿™ä¹ˆå†™çš„è¯ä¼šæŠ¥é”™,IDE ä¼šæç¤ºæˆ‘ä»¬ç›¸åº”çš„ä¿¡æ¯
> animal(ArrayList<Dog>)' clashes with 'animal(ArrayList<Bird>)'; both methods have same erasure

ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°æœ‰ç›¸åŒçš„æ“¦é™¤ç±»å‹,ç¼–è¯‘åä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªæ–¹æ³•.
åŒæ ·çš„,æˆ‘ä»¬åœ¨**æ•è·æ³›å‹å¼‚å¸¸**æ—¶ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„æŠ¥é”™ä¿¡æ¯.

### Javaä¸­çš„æ³›å‹æ“¦é™¤
é¢è¯•å¸¸è§çš„å…«è‚¡æ–‡,æˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹,è¿™éƒ¨åˆ†å¯ä»¥è·³è¿‡ä¸çœ‹.
æ¯”å¦‚æˆ‘ä»¬åœ¨C#ä¸­æœ‰å¦‚ä¸‹ä»£ç 
``` C#
using System; 

public class Program{ 
    public static void Main(String[] args){ 
        test<string>(); 
    }    
    public static void test<T>(){ 
        Console.WriteLine(typeof(T)); 
    } 
} 
```
è¿™é‡Œçš„æ³›å‹ T ç±»å‹string æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–åˆ°çš„,å¹¶ä¸”åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªçœŸå®å¯ç”¨çš„ç±»å‹.
ä½†åœ¨Javaæ˜¯ä¸è¡Œçš„,ç”±äºå‘ä¸Šå…¼å®¹å†å²ä»£ç çš„åŸå›  Java é‡‡ç”¨äº†`Code sharing`çš„ç­–ç•¥,ä½¿å¾—æ³›å‹åªå­˜åœ¨äºæºç é˜¶æ®µ,ç¼–è¯‘è¿‡åçš„Classæ–‡ä»¶å¹¶ä¸å­˜åœ¨æ³›å‹,è™šæ‹Ÿæœºå¹¶ä¸çŸ¥é“æ³›å‹çš„å­˜åœ¨,æ‰€ä»¥è¯´Javaä¸­çš„æ³›å‹æ˜¯ä¸€ç§ä¼ªæ³›å‹,è¿™ç§å‚æ•°ç±»å‹åªå­˜åœ¨äºæºç é˜¶æ®µåœ¨ç¼–è¯‘åå¹¶ä¸å­˜åœ¨çš„æœºåˆ¶æˆ‘ä»¬å«åš**æ³›å‹æ“¦é™¤**.ä¸ºäº†ä¿æŒæ³›å‹ç»§æ‰¿æˆ–å®ç°å…³ç³»çš„æ­£ç¡®æ€§,java ä¸­è¿˜æœ‰ä¸€ç§ç­–ç•¥ï¼š**æ¡¥æ–¹æ³•ç”Ÿæˆ(Bridge Method Generation)**:
ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜æ¡¥æ–¹æ³•ç”Ÿæˆï¼š
``` Java
class Shape<T> {
    public void draw(T shape) {
        System.out.println("Drawing shape: " + shape.toString());
    }
}

class Circle extends Shape<String> {
    @Override
    public void draw(String shape) {
        System.out.println("Drawing circle: " + shape);
    }
}
```
åœ¨ç±»å‹æ“¦é™¤å,ç¼–è¯‘å™¨ä¼šç”Ÿæˆæ¡¥æ–¹æ³•æ¥ä¿æŒæ³›å‹ç»§æ‰¿å…³ç³»çš„æ­£ç¡®æ€§.åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­,ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ¡¥æ–¹æ³•,ä½¿å¾—Circleç±»çš„æ–¹æ³•ç­¾åä¸çˆ¶ç±»çš„æ–¹æ³•ç­¾åä¿æŒä¸€è‡´,ä½†è¿”å›ç±»å‹è¢«æ“¦é™¤ä¸ºçˆ¶ç±»çš„ç±»å‹å‚æ•°.
``` Java
class Circle extends Shape<String> {
    @Override
    public void draw(String shape) {
        System.out.println("Drawing circle: " + shape);
    }

    // ç”Ÿæˆçš„æ¡¥æ–¹æ³•
    @Override
    public void draw(Object shape) {
        draw((String) shape);
    }
}
```
é€šè¿‡ç”Ÿæˆçš„æ¡¥æ–¹æ³•,å³draw(Object shape),åœ¨ç±»å‹æ“¦é™¤åä»ç„¶èƒ½å¤Ÿæ­£ç¡®åœ°è°ƒç”¨æ³›å‹æ–¹æ³•.è¿™æ ·,å³ä½¿åœ¨ç¼–è¯‘å™¨çœ‹ä¸åˆ°å…·ä½“çš„æ³›å‹ç±»å‹ä¿¡æ¯,ä»ç„¶å¯ä»¥é€šè¿‡æ¡¥æ–¹æ³•æ¥è°ƒç”¨æ­£ç¡®çš„æ–¹æ³•å®ç°.
æ„Ÿå…´è¶£çš„è¯å¯ä»¥æœä¸€ä¸‹å…³é”®å­—:æ³›å‹æ“¦é™¤ã€æ¡¥æ–¹æ³•ç”Ÿæˆã€Code sharinã€Code specialization

### Java ä¸­çš„æ³›å‹é€šé…ç¬¦

å‡å¦‚æˆ‘ä»¬çœŸçš„æœ‰åƒä¸Šé¢é‚£ç§èµ‹å€¼éœ€æ±‚æ€ä¹ˆæï¼Ÿjava ç»™æˆ‘ä»¬æä¾›äº†`æ³›å‹é€šé…ç¬¦`: **? extends** å’Œ **? super** æ¥è§£å†³è¿™ä¸ªé—®é¢˜.
å•°å—¦ä¸€ä¸‹ï¼šåœ¨ç»§æ‰¿å…³ç³»ä¸Š,ä¸€èˆ¬æƒ…å†µä¸‹å°†çˆ¶ç±»æ”¾åœ¨ä¸Šæ–¹,å­ç±»æ”¾åœ¨ä¸‹æ–¹.æ¯”å¦‚ä¸Šé¢å®šä¹‰çš„ç±»
{% mermaid %}
graph TB

A(Animal)
A10(Dog)
A11(Bird)
A20(Poodle)
A-->A10
A-->A11
A10-->A20

{% endmermaid %}


#### ? extends
æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™
``` Java
ArrayList<? extends Animal> arrayList ;
arrayList = new ArrayList<Bird>();
arrayList = new ArrayList<Dog>();
arrayList = new ArrayList<Animal>();
```
è¿™é‡Œçš„`? extends`å«åš**ä¸Šç•Œé€šé…ç¬¦**,å¯ä»¥ä½¿ Java æ³›å‹å…·æœ‰**åå˜æ€§ Covariance**,åå˜å°±æ˜¯å…è®¸ä¸Šé¢çš„èµ‹å€¼æ˜¯åˆæ³•çš„.
ä¸è¿‡è¿™é‡Œçš„`extends`å’Œæˆ‘ä»¬å®šä¹‰`class`æ—¶ç»§æ‰¿æŸä¸ªç±»ç”¨çš„`extends`æœ‰ä¸€ç‚¹ç‚¹ä¸ä¸€æ ·,é™¤äº†ä¸Šç•Œæ‰€æœ‰çš„ç›´æ¥å­ç±»ã€é—´æ¥å­ç±»è¿˜åŒ…å«å®ƒæœ¬èº«,å¹¶ä¸”ä¸Šç•Œä¹Ÿå¯ä»¥æ˜¯ interface.
åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­,`ArrayList<? extends Animal>`è¡¨ç¤ºåˆ—è¡¨ä¸­å¯ä»¥å­˜æ”¾ Animal åŠå…¶å­ç±»ã€é—´æ¥å­ç±»çš„ç±»å‹.ä¹Ÿå°±æ˜¯ç¡®è®¤äº†å®ƒçš„ä¸Šé™èƒ½åˆ°å“ªä¸€å±‚.
ä½†æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ³›å‹é€šé…ç¬¦ä¹‹å,åœ¨ä½¿ç”¨ä¸Šä¼šæœ‰ä¸€äº›å°é—®é¢˜ï¼š
``` Java
arrayList.add(new Dog());//error
arrayList.add(new Bird());//error
arrayList.add(new Animal());//error
Animal result =  arrayList.get(0);//ok
```

ç”±äº`arrayList`ä¸­å­˜æ”¾çš„å¯ä»¥æ˜¯**Animal åŠå…¶å­ç±»ã€é—´æ¥å­ç±»çš„ç±»å‹**,æ‰€ä»¥æˆ‘ä»¬å¹¶ä¸ç¡®å®šæ˜¯å“ªç§ç±»å‹,å› æ­¤æˆ‘ä»¬æ— æ³•å‘åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ ,ä½†å¯ä»¥ç¡®å®šçš„æ˜¯,å°†åˆ—è¡¨ä¸­çš„å…ƒç´ èµ‹å€¼ç»™ Animalç±»å‹çš„å˜é‡æ˜¯æ²¡é—®é¢˜çš„.
åƒè¿™ç§åªèƒ½ä»åˆ—è¡¨ä¸­è¯»å–æ•°æ®æä¾›,ä½†ä¸èƒ½å‘åˆ—è¡¨ä¸­å†™å…¥çš„æƒ…å†µæˆ‘ä»¬ç§°ä¹‹ä¸º`ç”Ÿäº§è€…`

#### ? super

æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™
``` Java
ArrayList<? super Dog> list ;
list = new ArrayList<Dog>();
list = new ArrayList<Animal>();
list = new ArrayList<Poodle>();//error

```
è¿™é‡Œçš„`? super`å«åš**ä¸‹ç•Œé€šé…ç¬¦**,å¯ä»¥ä½¿Javaæ³›å‹å…·**é€†å˜æ€§ Contravariance**,é€†å˜å°±æ˜¯å…è®¸ä¸Šé¢çš„èµ‹å€¼æ˜¯åˆæ³•çš„.
é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹ç•Œé€šé…ç¬¦ç¡®å®šäº†åˆ—è¡¨çš„ä¸‹é™,ä¹Ÿå°±æ˜¯ç¡®è®¤äº†ä¸‹é™åœ¨å“ªä¸€å±‚,æˆ‘ä»¬å¯ä»¥å°†è¯¥å±‚åŠä»¥ä¸Šçš„ç±»å‹èµ‹å€¼ç»™ list.åŒæ ·çš„,æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸Šä¹Ÿæœ‰ä¸€ç‚¹ç‚¹å°é—®é¢˜ï¼š
``` Java
list.add(new Dog());
list.add(new Poodle());
list.add(new Animal());//error

Object dog = list.get(0);
```
å› ä¸ºlist ä¸­å­˜æ”¾çš„è‚¯å®šæ˜¯**Dogæˆ–è€…å…¶çˆ¶ç±»ã€é—´æ¥çˆ¶ç±»**,æ ¹æ®é‡Œæ°æ›¿æ¢åŸåˆ™,ä»»ä½•ä½¿ç”¨çˆ¶ç±»çš„åœ°æ–¹å¯ä»¥è¢«å®ƒçš„å­ç±»æ›¿æ¢,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘ list ä¸­æ·»åŠ **Dogæˆ–å…¶å­ç±»ã€é—´æ¥å­ç±»**.ä½†æ˜¯å½“æˆ‘ä»¬ä» list ä¸­å–æ•°æ®çš„æ—¶å€™,ç”±äºä¸çŸ¥é“ list ä¸­å­˜æ”¾çš„å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹,åœ¨ java ä¸­ Object æ˜¯æ‰€æœ‰ç±»å‹çš„çˆ¶ç±»,æ‰€ä»¥è¿™é‡Œå–åˆ°çš„æ•°æ®è¿”å›çš„**Object**ç±»å‹.

ä¸€èˆ¬æƒ…å†µä¸‹,æˆ‘ä»¬è·å–åˆ°Objectå¯ä»¥é€šè¿‡`className`æˆ–è€…`instanceof`æ¥åˆ¤æ–­å…·ä½“ç±»å‹,ä½†æˆ‘ä»¬å°±å…ˆå¿½ç•¥å§.
åƒè¿™ç§åªå†™å…¥è€Œä¸è¯»å–çš„æ³›å‹ç±»å‹å£°æ˜æƒ…å†µç§°ä¹‹ä¸º**æ¶ˆè´¹è€… Consumer**.

#### æ— è¾¹ç•Œé€šé…ç¬¦

è¿˜æœ‰ä¸€ç§æ— è¾¹ç•Œé€šé…ç¬¦,ç”¨å•é—®å·è¡¨ç¤ºï¼šList<?>,ä¹Ÿå°±æ˜¯æ²¡æœ‰ä»»ä½•é™å®š,ç›¸å½“äº`? extends Object`.éœ€è¦æ³¨æ„çš„æ˜¯,å®ƒå’Œä¸ä½¿ç”¨ç±»å‹çš„ List è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š
* List<?> listè¡¨ç¤ºçš„æ˜¯åˆ—è¡¨ä¿å­˜æŸä¸ªç‰¹å®šç±»å‹çš„å¯¹è±¡,ä½†æˆ‘ä»¬ä¸èƒ½å‘å…¶ä¸­æ·»åŠ ä»»ä½•å…ƒç´ ,å› ä¸ºæˆ‘ä»¬ä¸æ¸…æ¥š list ä¸­ä¿å­˜çš„æ˜¯é‚£ç§ç±»å‹
* æ²¡æœ‰æ³›å‹å‚æ•°çš„ List è¡¨ç¤ºè¯¥åˆ—è¡¨æŒæœ‰çš„å…ƒç´ ç±»å‹æ˜¯ Object,å› æ­¤å¯ä»¥æ·»åŠ ä»»ä½•ç±»å‹çš„å¯¹è±¡,ä½†ç¼–è¯‘å™¨ä¼šæœ‰è­¦å‘Šä¿¡æ¯.

#### å°ç»“
å°å°çš„æ€»ç»“ä¸€ä¸‹ï¼š
åˆ©ç”¨`? extends`å½¢å¼çš„é€šé…ç¬¦å¯ä»¥å®ç°æ³›å‹çš„å‘ä¸Šè½¬å‹,ä¹Ÿå°±æ˜¯æ”¯æŒåå˜.ä½†ä½¿ç”¨ä¸Šé€šé…ç¬¦åç¼–è¯‘å™¨ä¸ºäº†ä¿è¯è¿è¡Œæ—¶çš„å®‰å…¨,ä¼šé™å®šå¯¹å…¶å†™çš„æ“ä½œ,å¼€æ”¾è¯»çš„æ“ä½œä¹Ÿå°±æ˜¯**åªèƒ½è¯»å–ä¸èƒ½ä¿®æ”¹**
åˆ©ç”¨`? super T`å½¢å¼çš„é€šé…ç¬¦å¯ä»¥å®ç°æ³›å‹çš„å‘ä¸‹è½¬å‹,ä¹Ÿå°±æ˜¯æ”¯æŒé€†å˜,ä¸ä¸Šé€šé…ç¬¦ç›¸å,ä¸‹è¾¹ç•Œé€šé…ç¬¦é€šå¸¸é™å®šè¯»çš„æ“ä½œ,å¼€æ”¾å†™çš„æ“ä½œ,ä¹Ÿå°±æ˜¯**åªèƒ½ä¿®æ”¹ä¸èƒ½è¯»å–**

Joshua Bloch åœ¨å…¶è‘—ä½œã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆ ä¸­å¾ˆå¥½åœ°è§£é‡Šäº†è¯¥é—®é¢˜ (ç¬¬ 31 æ¡ï¼šâ€œåˆ©ç”¨æœ‰é™åˆ¶é€šé…ç¬¦æ¥æå‡ API çš„çµæ´»æ€§â€). ä»–ç§°é‚£äº›ä½ åªèƒ½ä»ä¸­è¯»å–çš„å¯¹è±¡ä¸ºç”Ÿäº§è€…, å¹¶ç§°é‚£äº›åªèƒ½å‘å…¶å†™å…¥çš„å¯¹è±¡ä¸ºæ¶ˆè´¹è€….ä»–å»ºè®®ï¼š
>ä¸ºäº†çµæ´»æ€§æœ€å¤§åŒ–,åœ¨è¡¨ç¤ºç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…çš„è¾“å…¥å‚æ•°ä¸Šä½¿ç”¨é€šé…ç¬¦ç±»å‹.

ä»–è¿˜æå‡ºäº†ä»¥ä¸‹åŠ©è®°ç¬¦ï¼šPECS ä»£è¡¨ç”Ÿäº§è€…-Extendsã€æ¶ˆè´¹è€…-Super(Producer-Extends, Consumer-Super).

### kotlin ä¸­çš„æ³›å‹é€šé…ç¬¦
ç†æ¸…æ¥šäº† java ä¸­çš„æ³›å‹é€šé…ç¬¦,æ¥ç€æˆ‘ä»¬çœ‹ä¸€ä¸‹ kotlin ä¸­çš„é€šé…ç¬¦,ç›¸å¯¹äº Java çš„é€šé…ç¬¦æå‡ºäº†ä¸€ç§æ–°çš„å®šä¹‰ï¼š**å£°æ˜å¤„å‹å˜(declaration-site variance)**ä¸**ç±»å‹æŠ•å½±(type projections)**
å…ˆä» kotlin ä¸­çš„é€šé…ç¬¦è¯´èµ·ï¼š
å’Œ java æ³›å‹ä¸€æ ·ï¼Œkotlin ä¸­çš„æ³›å‹ä¹Ÿæ˜¯ä¸å˜çš„ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿæä¾›äº†ç›¸åº”çš„å…³é”®å­—æ¥æ”¯æŒ**åå˜**å’Œ**é€†å˜**
* ä½¿ç”¨å…³é”®å­—`out`æ¥æ”¯æŒåå˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸Šç•Œé€šé…ç¬¦`? extends`ã€‚
* ä½¿ç”¨å…³é”®å­—`in`æ¥æ”¯æŒé€†å˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸‹ç•Œé€šé…ç¬¦`? super`ã€‚

``` kotlin
val outList: MutableList<out TestMain.Animal> = mutableListOf()
val outListItem: TestMain.Animal = outList[0]


val inList: MutableList<in TestMain.Animal> = mutableListOf()
inList.add(TestMain.Dog())
inList.add(TestMain.Bird())
inList.add(TestMain.Poodle())
val inListItem: Any? = inList[0]
```
æ— éæ˜¯æ¢äº†ä¸ªå†™æ³•è€Œå·²ï¼Œæ²¡å¤šå¤§å·®åˆ«.ä¸è¿‡éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œkotlin åŒæ—¶æ”¯æŒä½¿ç”¨å¤„å‹å˜å’Œå£°æ˜å¤„å‹å˜ã€‚
ä¸¾ä¸€ä¸ªç”¨çƒ‚äº†çš„ä¾‹å­
``` kotlin
class Producer<out T> {
    fun produce(): T {
        return null as T
    }
}
class Consumer<in T> {
    fun consume(t: T) {
        println(t)
    }
}
val producer: Producer<TestMain.Animal> = Producer()
val animal: TestMain.Animal = producer.produce()

val consumer: Consumer<TestMain.Animal> = Consumer()
consumer.consume(TestMain.Dog())
```
å¦‚æœæˆ‘ä»¬ç¡®è®¤æ³›å‹å‚æ•°åªç”¨æ¥è¾“å…¥æˆ–è€…è¾“å‡ºï¼Œå¯ä»¥åœ¨å£°æ˜å¤„ç›´æ¥æ·»åŠ `in`æˆ–è€…`out`.å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨å¤„æ·»åŠ å£°æ˜
``` kotlin
class Producer1<T> {
    fun produce(): T? {
        return null
    }
}
class Consumer1<T> {
    fun consume(t: T) {
        println(t)
    }
}
val producer1: Producer1<out TestMain.Animal> = Producer1()
val animal1: TestMain.Animal? = producer1.produce()

val consumer1: Consumer1<in TestMain.Animal> = Consumer1()
consumer1.consume(TestMain.Dog())
```
è¿™é‡Œä¹Ÿå°±æ˜¯ç»å¸¸è¯´çš„ **æ¶ˆè´¹è€… in, ç”Ÿäº§è€… out**

#### ç±»å‹æŠ•å½±

è¿™ä¸ªä¸œè¥¿å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæ ¹æ®å®˜æ–¹æè¿°æ˜¯è¿™æ ·çš„:
å°†ç±»å‹å‚æ•°`T`å£°æ˜ä¸º`out`éå¸¸ç®€å•ï¼Œå¹¶ä¸”èƒ½é¿å…ä½¿ç”¨å¤„å­ç±»å‹åŒ–çš„éº»çƒ¦ï¼Œä½†æ˜¯æœ‰äº›ç±»å®é™…ä¸Šä¸èƒ½é™åˆ¶ä¸ºåªè¿”å›`T`ï¼ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯`Array`ï¼š
``` kotlin
class Array<T>(val size: Int) {
    operator fun get(index: Int): T { â€¦â€¦ }
    operator fun set(index: Int, value: T) { â€¦â€¦ }
}
```
è¯¥ç±»åœ¨`T`ä¸Šæ—¢ä¸èƒ½æ˜¯åå˜çš„ä¹Ÿä¸èƒ½æ˜¯é€†å˜çš„ã€‚è¿™é€ æˆäº†ä¸€äº›ä¸çµæ´»æ€§ã€‚è€ƒè™‘ä¸‹è¿°å‡½æ•°ï¼š
``` kotlin
fun copy(from: Array<Any>, to: Array<Any>) {
    assert(from.size == to.size)
    for (i in from.indices)
        to[i] = from[i]
}
```
è¿™ä¸ªå‡½æ•°åº”è¯¥å°†é¡¹ç›®ä»ä¸€ä¸ªæ•°ç»„å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ•°ç»„ã€‚è®©æˆ‘ä»¬å°è¯•åœ¨å®è·µä¸­åº”ç”¨å®ƒï¼š
``` kotlin
val ints: Array<Int> = arrayOf(1, 2, 3)
val any = Array<Any>(3) { "" } 
copy(ints, any)
//   ^ å…¶ç±»å‹ä¸º Array<Int> ä½†æ­¤å¤„æœŸæœ› Array<Any>
```
è¿™é‡Œæˆ‘ä»¬é‡åˆ°åŒæ ·ç†Ÿæ‚‰çš„é—®é¢˜ï¼š`Array<T>`åœ¨`T`ä¸Šæ˜¯**ä¸å‹å˜**çš„ï¼Œå› æ­¤`Array<Int>` ä¸ `Array<Any>` éƒ½ä¸æ˜¯å¦ä¸€ä¸ªçš„å­ç±»å‹ã€‚ä¸ºä»€ä¹ˆï¼Ÿ å†æ¬¡é‡å¤ï¼Œå› ä¸º`copy`å¯èƒ½æœ‰éé¢„æœŸè¡Œä¸ºï¼Œä¾‹å¦‚å®ƒå¯èƒ½å°è¯•å†™ä¸€ä¸ª`String`åˆ°`from`ï¼Œå¹¶ä¸”å¦‚æœæˆ‘ä»¬å®é™…ä¸Šä¼ é€’ä¸€ä¸ª`Int`çš„æ•°ç»„ï¼Œä»¥åä¼šæŠ›`ClassCastException`å¼‚å¸¸ã€‚
å¦‚æœéœ€è¦ç¦æ­¢`copy`åŠŸèƒ½å†™å…¥`from`ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ:
``` kotlin
fun copy(from: Array<out Any>, to: Array<Any>) { â€¦â€¦ }
```
è¿™å°±æ˜¯ç±»å‹æŠ•å½±ï¼šæ„å‘³ç€`from`ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ª`å—é™åˆ¶`çš„**ï¼ˆæŠ•å½±çš„ï¼‰**æ•°ç»„ã€‚ åªå¯ä»¥è°ƒç”¨è¿”å›ç±»å‹ä¸ºç±»å‹å‚æ•°`T`çš„æ–¹æ³•ï¼Œå¦‚ä¸Šï¼Œè¿™æ„å‘³ç€åªèƒ½è°ƒç”¨`get()`ã€‚ è¿™å°±æ˜¯ä½¿ç”¨å¤„å‹å˜çš„ç”¨æ³•ï¼Œå¹¶ä¸”æ˜¯å¯¹åº”äº Java çš„ `Array<? extends Object>`, ä½†æ›´ç®€å•ã€‚

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨`in`æŠ•å½±ä¸€ä¸ªç±»å‹ï¼š
``` kotlin
fun fill(dest: Array<in String>, value: String) { â€¦â€¦ }
```
`Array<in String>` å¯¹åº”äº Java çš„`Array<? super String>`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ª`CharSequence`æ•°ç»„æˆ–ä¸€ä¸ª`Object`æ•°ç»„ç»™`fill()`å‡½æ•°ã€‚
**ä»¥ä¸Šä¿¡æ¯æ¥è‡ª [kotlin ä¸­æ–‡ç½‘]((https://book.kotlincn.net/text/generics.html))**
#### æ˜ŸæŠ•å½±

æœ‰æ—¶ä½ æƒ³è¯´ï¼Œä½ å¯¹ç±»å‹å‚æ•°ä¸€æ— æ‰€çŸ¥ï¼Œä½†ä»ç„¶å¸Œæœ›ä»¥å®‰å…¨çš„æ–¹å¼ä½¿ç”¨å®ƒã€‚ è¿™é‡Œçš„å®‰å…¨æ–¹å¼æ˜¯å®šä¹‰æ³›å‹ç±»å‹çš„è¿™ç§æŠ•å½±ï¼Œè¯¥æ³›å‹ç±»å‹çš„æ¯ä¸ªå…·ä½“å®ä¾‹åŒ–éƒ½ä¼šæ˜¯è¯¥æŠ•å½±çš„å­ç±»å‹ã€‚

Kotlin ä¸ºæ­¤æä¾›äº†æ‰€è°“çš„**æ˜ŸæŠ•å½±**è¯­æ³•ï¼š

* å¯¹äº`Foo <out T : TUpper>`ï¼Œå…¶ä¸­`T`æ˜¯ä¸€ä¸ªå…·æœ‰ä¸Šç•Œ`TUpper`çš„åå˜ç±»å‹å‚æ•°ï¼Œ`Foo <*>`ç­‰ä»·äº`Foo <out TUpper>`ã€‚ æ„å‘³ç€å½“`T`æœªçŸ¥æ—¶ï¼Œä½ å¯ä»¥å®‰å…¨åœ°ä»`Foo <*>`è¯»å–`TUpper`çš„å€¼ã€‚
* å¯¹äº`Foo <in T>`ï¼Œå…¶ä¸­`T`æ˜¯ä¸€ä¸ªé€†å˜ç±»å‹å‚æ•°ï¼Œ`Foo <*>`ç­‰ä»·äº`Foo <in Nothing>`ã€‚ æ„å‘³ç€å½“`T`æœªçŸ¥æ—¶ï¼Œ æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ä»¥å®‰å…¨çš„æ–¹å¼å†™å…¥`Foo <*>`ã€‚
* å¯¹äº`Foo <T : TUpper>`ï¼Œå…¶ä¸­`T`æ˜¯ä¸€ä¸ªå…·æœ‰ä¸Šç•Œ`TUpper`çš„ä¸å‹å˜ç±»å‹å‚æ•°,`Foo<*>`å¯¹äºè¯»å–å€¼æ—¶ç­‰ä»·äº`Foo<out TUpper>` è€Œå¯¹äºå†™å€¼æ—¶ç­‰ä»·äº`Foo<in Nothing>`ã€‚

å¦‚æœæ³›å‹ç±»å‹å…·æœ‰å¤šä¸ªç±»å‹å‚æ•°ï¼Œåˆ™æ¯ä¸ªç±»å‹å‚æ•°éƒ½å¯ä»¥å•ç‹¬æŠ•å½±ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç±»å‹è¢«å£°æ˜ä¸º interface Function <in T, out U>ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ˜ŸæŠ•å½±ï¼š

* `Function<*, String>` è¡¨ç¤º`Function<in Nothing, String>`ã€‚
* `Function<Int, *>` è¡¨ç¤º`Function<Int, out Any?>`ã€‚
* `Function<*, *>` è¡¨ç¤º`Function<in Nothing, out Any?>`ã€‚

**ä»¥ä¸Šä¿¡æ¯æ¥è‡ª [kotlin ä¸­æ–‡ç½‘]((https://book.kotlincn.net/text/generics.html))**

#### æ³›å‹æ–¹æ³•

ä¸ä»…ç±»å¯ä»¥æœ‰ç±»å‹å‚æ•°ã€‚å‡½æ•°ä¹Ÿå¯ä»¥æœ‰ã€‚ç±»å‹å‚æ•°è¦æ”¾åœ¨å‡½æ•°åç§°ä¹‹å‰ï¼š
``` kotlin
fun <T> singletonList(item: T): List<T> {
    // â€¦â€¦
}

fun <T> T.basicToString(): String { // æ‰©å±•å‡½æ•°
    // â€¦â€¦
}
```
è¦è°ƒç”¨æ³›å‹å‡½æ•°ï¼Œåœ¨è°ƒç”¨å¤„å‡½æ•°åä¹‹åæŒ‡å®šç±»å‹å‚æ•°å³å¯ï¼š
``` kotlin
val l = singletonList<Int>(1)
```

å¯ä»¥çœç•¥èƒ½å¤Ÿä»ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºæ¥çš„ç±»å‹å‚æ•°ï¼Œæ‰€ä»¥ä»¥ä¸‹ç¤ºä¾‹åŒæ ·é€‚ç”¨ï¼š
``` kotlin
val l = singletonList(1)
```

#### æ³›å‹çº¦æŸ

èƒ½å¤Ÿæ›¿æ¢ç»™å®šç±»å‹å‚æ•°çš„æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆå¯ä»¥ç”±**æ³›å‹çº¦æŸ**é™åˆ¶ã€‚
æœ€å¸¸è§çš„çº¦æŸç±»å‹æ˜¯ä¸Šç•Œï¼Œä¸Javaçš„`extends`å…³é”®å­—å¯¹åº”ï¼š
``` kotlin
fun <T : Comparable<T>> sort(list: List<T>) {  â€¦â€¦ }
```
å†’å·ä¹‹åæŒ‡å®šçš„ç±»å‹æ˜¯ä¸Šç•Œï¼Œè¡¨æ˜åªæœ‰`Comparable<T>`çš„å­ç±»å‹å¯ä»¥æ›¿ä»£`T`ã€‚ ä¾‹å¦‚ï¼š
``` kotlin
sort(listOf(1, 2, 3)) // OKã€‚Int æ˜¯ Comparable<Int> çš„å­ç±»å‹
sort(listOf(HashMap<Int, String>())) // é”™è¯¯ï¼šHashMap<Int, String> ä¸æ˜¯ Comparable<HashMap<Int, String>> çš„å­ç±»å‹
```
é»˜è®¤çš„ä¸Šç•Œï¼ˆå¦‚æœæ²¡æœ‰å£°æ˜ï¼‰æ˜¯ Any?ã€‚åœ¨å°–æ‹¬å·ä¸­åªèƒ½æŒ‡å®šä¸€ä¸ªä¸Šç•Œã€‚ å¦‚æœåŒä¸€ç±»å‹å‚æ•°éœ€è¦å¤šä¸ªä¸Šç•Œï¼Œéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ where-å­å¥ï¼š
``` kotlin
fun <T> copyWhenGreater(list: List<T>, threshold: T): List<String>
    where T : CharSequence,
          T : Comparable<T> {
    return list.filter { it > threshold }.map { it.toString() }
}
```
æ‰€ä¼ é€’çš„ç±»å‹å¿…é¡»åŒæ—¶æ»¡è¶³`where`å­å¥çš„æ‰€æœ‰æ¡ä»¶ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œç±»å‹`T`å¿…é¡»**æ—¢å®ç°äº† CharSequence ä¹Ÿå®ç°äº† Comparable**ã€‚
è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œwhere å­å¥åé¢çš„ç¬¬ä¸€ä¸ªç±»å‹å¯ä»¥æ˜¯æ¥å£ä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ã€å®ç°ç±»ï¼Œåç»­çš„ç±»å‹åªèƒ½æ˜¯æ¥å£ã€‚åœ¨ Java ä¸­ä¹Ÿä¸€æ ·
``` Java
public interface MyInterface {
    void test();
}
public abstract class MyAbstractClass {
    public abstract void test();
}

public <T extends MyInterface & MyAbstractClass> void test(T t){ //errpr
    t.test();
}
public <T extends  MyAbstractClass & MyInterface > void test(T t){
    t.test();
}
    
```
åŸå› å°±æ˜¯ java ä¸­ä¸å¯ä»¥å¤šç»§æ‰¿ä½†å¯ä»¥å¤šå®ç°

####  @UnsafeVariance
å·®ç‚¹å¿˜äº†è¿™ä¸œè¥¿ï¼Œè¿™ä¸ªæ³¨è§£å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆï¼Œå¹¶ä¸”ä¿è¯ä¸ä¼šå‡ºé—®é¢˜ï¼Œå¿½ç•¥åå˜å’Œé€†å˜çš„çº¦æŸå°±å¥½äº†
æ¯”å¦‚ kotlin ä¸­çš„`Collection`è¿™ä¸ªç±»ä¸­çš„`contains`ã€`containsAll`æ–¹æ³•
``` kotlin
public interface Collection<out E> : Iterable<E> {
    public operator fun contains(element: @UnsafeVariance E): Boolean
    public fun containsAll(elements: Collection<@UnsafeVariance E>): Boolean
}
```
> å¯¹äºåå˜çš„ç±»å‹ï¼Œé€šå¸¸æˆ‘ä»¬æ˜¯ä¸å…è®¸å°†æ³›å‹ç±»å‹ä½œä¸ºä¼ å…¥å‚æ•°çš„ç±»å‹çš„ï¼Œæˆ–è€…è¯´ï¼Œå¯¹äºåå˜ç±»å‹ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯ä¸å…è®¸å…¶æ¶‰åŠæ³›å‹å‚æ•°çš„éƒ¨åˆ†è¢«æ”¹å˜çš„ã€‚
> è¿™ä¹Ÿå¾ˆå®¹æ˜“è§£>é‡Šä¸ºä»€ä¹ˆ MutableCollection æ˜¯ä¸å˜çš„ï¼Œè€Œ Collection æ˜¯åå˜çš„ï¼Œå› ä¸ºåœ¨ Kotlin å½“ä¸­ï¼Œå‰è€…æ˜¯å¯è¢«ä¿®æ”¹çš„ï¼Œåè€…æ˜¯ä¸å¯è¢«ä¿®æ”¹çš„ã€‚
> é€†å˜çš„æƒ…å½¢æ­£å¥½ç›¸åï¼Œå³ä¸å¯ä»¥å°†æ³›å‹å‚æ•°ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼ã€‚

æ¯”å¦‚è¿™ç§æƒ…å½¢ï¼Œä¸ºäº†è®©ç¼–è¯‘å™¨æ”¾è¿‡ä¸€é©¬ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ @UnsafeVariance æ¥å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œæˆ‘çŸ¥é“æˆ‘åœ¨å¹²å•¥ï¼Œä¿è¯ä¸ä¼šå‡ºé”™ï¼Œä½ ä¸ç”¨æ‹…å¿ƒâ€ã€‚
**ä»¥ä¸Šä¿¡æ¯æ¥è‡ª[æ·±å…¥è§£æKotlin æ³›å‹](https://zhuanlan.zhihu.com/p/143380842)**

#### reified å…³é”®å­—
ç”±äºå­˜åœ¨ç±»å‹æ“¦é™¤ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•åœ¨è¿è¡Œæ—¶è·å–æ³›å‹çš„å…·ä½“ç±»å‹ï¼Œæœ‰äº›æ“ä½œæ— æ³•å®ç°ï¼Œæ¯”å¦‚
``` Java
public static <T> void testOne(Object param){
    if(param instanceof T){
        System.out.println("T");
    }
}
```
å½“ç„¶ï¼Œåœ¨ kotlin ä¸­ä¹Ÿä¸è¡Œã€‚
ä½†åœ¨ java ä¸­æˆ‘ä»¬é€šå¸¸ä¼šä¼ å…¥ä¸€ä¸ª`Class<T>`æ¥åšç›¸åº”çš„æ“ä½œï¼Œåœ¨ kotlin ä¸­åŒæ ·ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡ kotlin ä¸­æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•:ä½¿ç”¨`reified`é…åˆ`inline`æ¥å®ç°
``` kotlin
inline fun <reified T> printIfTypeMatch(item: Any) {
    if (item is T) { // ğŸ‘ˆ è¿™é‡Œå°±ä¸ä¼šåœ¨æç¤ºé”™è¯¯äº†
        println(item)
    }
}
```
æˆ‘ä»¬ç»å¸¸ç”¨çš„ gsonè§£ææ•°æ®ã€ååºåˆ—åŒ–çš„æ—¶å€™ç»å¸¸é‡åˆ°
``` Java
public <T> T fromJson(String json, Class<T> classOfT) throws JsonSyntaxException { 
    
} 
```
è¿™é‡Œå°±æ˜¯é€šè¿‡å¤šä¼ å…¥ä¸€ä¸ª`Class<T>`æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ kotlin ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±•æ¥å˜åŒ–ä¸€ä¸‹
``` kotlin
inline fun <reified T> Gson.fromJson(json: String): T{ 
     return fromJson(json, T::class.java) 
 } 
```
æˆ‘ä»¬ç»™ Gson æ·»åŠ äº†ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé€šè¿‡`inline`å’Œ`reified`å…³é”®å­—å°†æ³›å‹`T`å˜æˆäº†ä¸€ä¸ªçœŸå®å¯ç”¨çš„ç±»å‹ï¼Œè¿™ä¸¤ä¸ªå…³é”®å­—ç¼ºä¸€ä¸å¯ã€‚è¿™é‡Œå°±ç®€å•çš„è®¤ä¸ºå†…è”æ–¹æ³•(inline)æ˜¯å°†æ–¹æ³•åœ¨ç¼–è¯‘æ—¶å¤åˆ¶åˆ°è°ƒç”¨å¤„ï¼Œä½¿å¾—æ³›å‹ T çš„ç±»å‹åœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥ç¡®å®šã€‚å½“ç„¶è¿™ä¹ˆç†è§£ä¸æ˜¯ç‰¹åˆ«æ­£ç¡®ã€‚åé¢å­¦åˆ°`inline`ã€`noinline`ã€`crossinline`è¿™å‡ ä¸ªå…³é”®å­—çš„æ—¶å€™å†è¯´å§


å‚è€ƒï¼š

[æ³›å‹ï¼šinã€outã€where](https://book.kotlincn.net/text/generics.html)
[Generics: in, out, where](https://kotlinlang.org/docs/generics.html)
[æ·±å…¥ç†è§£Javaå’ŒKotlinä¸­çš„æ³›å‹](https://ethanhua.github.io/2018/01/09/genericity/)
[æ·±å…¥è§£æKotlin æ³›å‹](https://zhuanlan.zhihu.com/p/143380842)

---- 
å·²å­¦ä¹ ï¼š
* æ‰©å±•
  * <input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input>
  * <input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input>
  * <input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input>

* å‡½æ•°ç±»å‹
  * <input type='checkbox' disabled='true' checked>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</input>
  * <input type='checkbox' disabled='true' checked>Lambdaè¡¨è¾¾å¼</input>
  * <input type='checkbox' disabled='true' checked>SAM è½¬æ¢</input>
* æ³›å‹
  * <input type='checkbox' disabled='true' checked>é€†å˜</input>
  * <input type='checkbox' disabled='true' checked>åå˜</input>
  * <input type='checkbox' disabled='true' checked>ç±»å‹æŠ•å½±</input>
  * <input type='checkbox' disabled='true' checked>æ˜ŸæŠ•å½±</input>
  * <input type='checkbox' disabled='true' checked>æ³›å‹çº¦æŸ</input>
* å…³é”®å­—
  * <input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸå‡½æ•°ï¼šwithã€letã€runã€applyã€also</input>

æœªå­¦ä¹ ï¼š
* å…³é”®å­—
  * object
  * Unit
  * Nothing
  * inline,noinline,crossinline

* å§”æ‰˜
   * å§”æ‰˜ç±»
   * å§”æ‰˜å±æ€§
   * è‡ªå®šä¹‰å§”æ‰˜

* åç¨‹
    * å¯åŠ¨
    * æŒ‚èµ·
    * Job
    * Context
    * Channel
    * Flow
    * select
    * å¹¶å‘ã€å¼‚å¸¸
    * launch
    * Dispatchers
    * CoroutineScope



